<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>SSHing into a VM hosted on a remote machine, i.e. how to use VSCode with a remotely hosted VM | ls ~niklas/</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="SSHing into a VM hosted on a remote machine, i.e. how to use VSCode with a remotely hosted VM" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Did you ever want to develop software in a VM that is hosted on a remote machine? If so, you probably didn’t consider this being a problem when using an editor like vim, which you install right on site. However, I try to use VSCode with the remote extension, and it expects to be able to directly connect via some SSH config into the target server. Specifically, my setup is as follows: I host a VM with Vagrant (called Y) on a remote server (called X) and want to use VSCode on my local machine to connect to Y." />
<meta property="og:description" content="Did you ever want to develop software in a VM that is hosted on a remote machine? If so, you probably didn’t consider this being a problem when using an editor like vim, which you install right on site. However, I try to use VSCode with the remote extension, and it expects to be able to directly connect via some SSH config into the target server. Specifically, my setup is as follows: I host a VM with Vagrant (called Y) on a remote server (called X) and want to use VSCode on my local machine to connect to Y." />
<link rel="canonical" href="https://nolte.dev/jekyll/update/2021/07/05/vscode-and-remote-virtual-machines.html" />
<meta property="og:url" content="https://nolte.dev/jekyll/update/2021/07/05/vscode-and-remote-virtual-machines.html" />
<meta property="og:site_name" content="ls ~niklas/" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-07-05T16:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="SSHing into a VM hosted on a remote machine, i.e. how to use VSCode with a remotely hosted VM" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-07-05T16:00:00+00:00","datePublished":"2021-07-05T16:00:00+00:00","description":"Did you ever want to develop software in a VM that is hosted on a remote machine? If so, you probably didn’t consider this being a problem when using an editor like vim, which you install right on site. However, I try to use VSCode with the remote extension, and it expects to be able to directly connect via some SSH config into the target server. Specifically, my setup is as follows: I host a VM with Vagrant (called Y) on a remote server (called X) and want to use VSCode on my local machine to connect to Y.","headline":"SSHing into a VM hosted on a remote machine, i.e. how to use VSCode with a remotely hosted VM","mainEntityOfPage":{"@type":"WebPage","@id":"https://nolte.dev/jekyll/update/2021/07/05/vscode-and-remote-virtual-machines.html"},"url":"https://nolte.dev/jekyll/update/2021/07/05/vscode-and-remote-virtual-machines.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://nolte.dev/feed.xml" title="ls ~niklas/" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">ls ~niklas/</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About me</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">SSHing into a VM hosted on a remote machine, i.e. how to use VSCode with a remotely hosted VM</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2021-07-05T16:00:00+00:00" itemprop="datePublished">Jul 5, 2021
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Did you ever want to develop software in a VM that is hosted on a remote machine?<br />
If so, you probably didn’t consider this being a problem when using an editor like vim, which you install right on site.
However, I try to use VSCode with the remote extension, and it expects to be able to directly connect via some SSH config into the target server.<br />
Specifically, my setup is as follows: I host a VM with <a href="https://www.vagrantup.com/">Vagrant</a> (called <code class="language-plaintext highlighter-rouge">Y</code>) on a remote server (called <code class="language-plaintext highlighter-rouge">X</code>) and want to use VSCode on my local machine to connect to
<code class="language-plaintext highlighter-rouge">Y</code>.</p>

<p>Now, Vagrant in its default setting hosts a VM on <code class="language-plaintext highlighter-rouge">localhost:2222</code> which you can then<br />
ssh to via <code class="language-plaintext highlighter-rouge">$ vagrant ssh</code>. With <code class="language-plaintext highlighter-rouge">$ vagrant ssh-config</code> you will get the ssh config used to
connect to it. It looks something like this, which works well from the remote machine:</p>
<div class="language-config highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Host</span> <span class="n">default</span>
  <span class="n">HostName</span> <span class="m">127</span>.<span class="m">0</span>.<span class="m">0</span>.<span class="m">1</span>
  <span class="n">User</span> <span class="n">vagrant</span>
  <span class="n">Port</span> <span class="m">2222</span>
  <span class="n">UserKnownHostsFile</span> /<span class="n">dev</span>/<span class="n">null</span>
  <span class="n">StrictHostKeyChecking</span> <span class="n">no</span>
  <span class="n">PasswordAuthentication</span> <span class="n">no</span>
  <span class="n">IdentityFile</span> /<span class="n">path</span>/<span class="n">to</span>/<span class="n">some</span>/<span class="n">generated</span>/<span class="n">private_key</span>
  <span class="n">IdentitiesOnly</span> <span class="n">yes</span>
  <span class="n">LogLevel</span> <span class="n">FATAL</span>
</code></pre></div></div>
<p>By pasting it into your <code class="language-plaintext highlighter-rouge">~/.ssh/config</code> you can then use <code class="language-plaintext highlighter-rouge">$ ssh default</code> to connect to it.
However, this only works on the remote machine where you set the VM up.
In order to connect to it from the outside, you need to somehow connect to the remote machine <code class="language-plaintext highlighter-rouge">X</code> at port
<code class="language-plaintext highlighter-rouge">2222</code>, which is likely closed to the outside.
The solution to this problem is a <code class="language-plaintext highlighter-rouge">ProxyJump</code>. <code class="language-plaintext highlighter-rouge">ProxyJump</code>s connect you to a remote machine via an intermediate “gateway” machine. The only unusual thing here is that the gateway machine is the same as the
target, only a different port.</p>

<p>So I tried something like this. Notice that I copied the private key to my local machine.</p>
<div class="language-config highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># On local machine
</span>
<span class="n">Host</span> <span class="n">X</span>
  <span class="n">HostName</span> <span class="n">X</span>.<span class="n">com</span>
  <span class="n">User</span> <span class="n">nnolte</span>
  ...

<span class="n">Host</span> <span class="n">default</span>
  <span class="n">HostName</span> <span class="n">X</span>.<span class="n">com</span>
  <span class="n">User</span> <span class="n">vagrant</span>
  <span class="n">Port</span> <span class="m">2222</span>
  <span class="n">ProxyJump</span> <span class="n">X</span>
  <span class="n">UserKnownHostsFile</span> /<span class="n">dev</span>/<span class="n">null</span>
  <span class="n">StrictHostKeyChecking</span> <span class="n">no</span>
  <span class="n">IdentityFile</span> <span class="n">path</span>/<span class="n">to</span>/<span class="n">copied</span>/<span class="n">private_key</span>
</code></pre></div></div>

<p>This did not work, gave me a connection refused, similar to when I tried directly connecting to port 2222.
No expert, but probably because this still counts as an external connection.
Funnily enough, swapping <code class="language-plaintext highlighter-rouge">HostName X.com</code> to <code class="language-plaintext highlighter-rouge">HostName localhost</code> turns out to be the solution:</p>

<div class="language-config highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># On local machine
</span>
<span class="n">Host</span> <span class="n">X</span>
  <span class="n">HostName</span> <span class="n">X</span>.<span class="n">com</span>
  <span class="n">User</span> <span class="n">nnolte</span>
  ...

<span class="n">Host</span> <span class="n">default</span>
  <span class="n">HostName</span> <span class="n">localhost</span> <span class="c"># NOT X.com
</span>  <span class="n">User</span> <span class="n">vagrant</span>
  <span class="n">Port</span> <span class="m">2222</span>
  <span class="n">ProxyJump</span> <span class="n">X</span>
  <span class="n">UserKnownHostsFile</span> /<span class="n">dev</span>/<span class="n">null</span>
  <span class="n">StrictHostKeyChecking</span> <span class="n">no</span>
  <span class="n">IdentityFile</span> <span class="n">path</span>/<span class="n">to</span>/<span class="n">copied</span>/<span class="n">private_key</span>
</code></pre></div></div>
<p>✨✨✨✨<br />
Cool, this worked. I am no expert on SSH config, but I did not expect <code class="language-plaintext highlighter-rouge">localhost</code> to be interpreted “relative” to the <code class="language-plaintext highlighter-rouge">ProxyJump</code>.</p>

<p>With this setup, you can connect to <code class="language-plaintext highlighter-rouge">default</code> from your local machine and use VSCode with the Remote extension as usual.</p>

  </div><a class="u-url" href="/jekyll/update/2021/07/05/vscode-and-remote-virtual-machines.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">ls ~niklas/</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">ls ~niklas/</li><li><a class="u-email" href="mailto:niklas'at'nolte'dot'dev">niklas'at'nolte'dot'dev</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/niklasnolte"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">niklasnolte</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>RS @Anthropic, previously @Meta AI (FAIR), @MIT and @CERN</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
